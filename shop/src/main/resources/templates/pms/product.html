<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>商品列表</title>
    <link rel="stylesheet" href="/static/layui/css/layui.css" media="all">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style type="text/css">
        .layui-table-cell {
            height: auto;
        }
    </style>
</head>
<body>

<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
    <legend>商品列表</legend>
</fieldset>

<div style="padding: 20px; background-color: #F2F2F2;">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md12">
            <div class="layui-card">
                <form class="layui-form we-search" onsubmit="return false" id="formBtn">
                    <div class="layui-card-header"><i class="layui-icon layui-icon-search" style="font-size: 20px"></i>
                        筛选搜索
                        <div style="float: right">
                            <button type="reset" class="layui-btn layui-btn-primary"> 重置
                            </button>
                            &nbsp;
                            <button type="submit" class="layui-btn" lay-submit="" lay-filter="search">
                                查询结果
                            </button>
                        </div>

                    </div>
                    <div class="layui-row layui-col-space15">
                        <div class="layui-col-md4">
                            <div class="layui-card">
                                <div class="layui-card-body">
                                    <div class="layui-form-item">
                                        <label class="layui-form-label">输入搜索：</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="productName"
                                                   placeholder="商品名称" style="width: 200px" autocomplete="off"
                                                   class="layui-input">
                                        </div>
                                    </div>
                                </div>
                                <div class="layui-card-body">
                                    <div class="layui-form-item">
                                        <label class="layui-form-label">商品品牌：</label>
                                        <div class="layui-input-block" style="width: 200px">
                                            <select name="brandId">
                                                <option value=""></option>
                                                <option value="0">北京</option>
                                                <option value="1">上海</option>
                                                <option value="2">广州</option>
                                                <option value="3">深圳</option>
                                                <option value="4">杭州</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="layui-col-md4">
                            <div class="layui-card">
                                <div class="layui-card-body">
                                    <div class="layui-form-item">
                                        <label class="layui-form-label">商品货号：</label>
                                        <div class="layui-input-block" style="width: 200px">
                                            <input type="text" name="productSn"
                                                   placeholder="商品货号" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                </div>
                                <div class="layui-card-body">
                                    <div class="layui-form-item">
                                        <label class="layui-form-label">上架状态：</label>
                                        <div class="layui-input-block" style="width: 200px">
                                            <select name="publishStatus">
                                                <option value=""></option>
                                                <option value="0">北京</option>
                                                <option value="1">上海</option>
                                                <option value="2">广州</option>
                                                <option value="3">深圳</option>
                                                <option value="4">杭州</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="layui-col-md4">
                            <div class="layui-card">
                                <div class="layui-card-body">
                                    <div class="layui-form-item">
                                        <label class="layui-form-label">商品分类</label>
                                        <div class="layui-input-block" style="width: 200px">
                                            <select name="productCategoryId">
                                                <option value=""></option>
                                                <option value="0">北京</option>
                                                <option value="1">上海</option>
                                                <option value="2">广州</option>
                                                <option value="3">深圳</option>
                                                <option value="4">杭州</option>
                                            </select>
                                        </div>
                                    </div>

                                </div>
                                <div class="layui-card-body">
                                    <div class="layui-form-item">
                                        <label class="layui-form-label">审核状态</label>
                                        <div class="layui-input-block" style="width: 200px">
                                            <select name="verifyStatus">
                                                <option value=""></option>
                                                <option value="0">北京</option>
                                                <option value="1">上海</option>
                                                <option value="2">广州</option>
                                                <option value="3">深圳</option>
                                                <option value="4">杭州</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<div style="padding: 20px; background-color: #F2F2F2;">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md12">
            <div class="layui-card">
                <div class="layui-card-body">
                    <br>
                    <i class="layui-icon layui-icon-list" style="font-size: 20px;"></i> &nbsp; <span style="font-size: 15px">数据列表</span>
                    <button type="button" class="layui-btn layui-btn-sm layui-btn-primary" style="float: right"> 添加
                    </button>
                    <br>
                    <br>
                </div>
            </div>
        </div>
    </div>
</div>
<div style="padding: 20px; background-color: #F2F2F2;">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md12">
            <div class="layui-card">
                <div class="layui-card-body">
                    <table class="layui-hide" id="test" style="height: inherit;text-overflow: inherit"></table>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="edit">查看</a>
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a><br>
    <a class="layui-btn layui-btn-xs" lay-event="edit">日志</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>

<script type="text/html" id="barLabel">
    <input type="checkbox" name="publishStatus" value="{{d.id}}" lay-skin="switch" lay-text="已上架|未上架"
           lay-filter="sexDemo" {{ d.publishStatus== 0 ? 'checked' : '' }}><br>
    <input type="checkbox" name="newStatus" value="{{d.id}}" lay-skin="switch" lay-text="是新品|非新品" lay-filter="sexDemo"
           {{
           d.newStatus== 0 ? 'checked' : '' }}><br>
    <!-- 这里的 checked 的状态只是演示 -->
    <input type="checkbox" name="recommandStatus" value="{{d.id}}" lay-skin="switch" lay-text="是推荐|不推荐"
           lay-filter="sexDemo" {{ d.recommandStatus== 0 ? 'checked' : '' }}>
</script>

<script type="text/html" id="barGoods">
    {{d.name}}<br>
    品牌：{{d.brandName}}
</script>

<script type="text/html" id="barPriceAndSn">
    价格：￥{{d.price}}<br>
    货号：{{d.productSn}}
</script>

<script type="text/html" id="barVerify">
    {{d.verifyStatusStr}}<br>
    <a href="#" style="color: #0000FF">审核详情</a>
</script>

<script type="text/html" id="label">
    <div class="site-demo-button" id="{{d.id}}" style="margin-bottom: 0;" onclick="btnFun('{{d.id}}')">
        <button data-method="offset" data-type="auto" class="layui-btn-xs layui-btn-radius layui-btn"><i
                class="layui-icon layui-icon-edit" style="font-size: 20px"></i></button>
    </div>
</script>

<script src="/static/layui/layui.js"></script>
<script type="text/javascript" crossorigin="anonymous" th:inline="none">
    layui.use(['layer', 'form', 'table', 'jquery'], function () {
        var layer = layui.layer;
        var table = layui.table;
        var $ = layui.$ //由于layer弹层依赖jQuery，所以可以直接得到
        var form = layui.form;
        //监听提交
        form.on('submit(formDemo)', function (data) {
            layer.msg(JSON.stringify(data.field));
            return false;
        });

        var tableIns = table.render({
            elem: '#test'
            , url: '/pms-product/getPageProductInfo/'
            , method: 'POST'
            , loading: false
            , cols: [
                [
                    {type: 'checkbox'}
                    , {field: 'id', unresize: true, align: 'center', width: 90, title: '编号', sort: true}
                    , {
                    field: 'pic', unresize: true,
                    title: '商品图片', width: 150,
                    templet: '<div><img src="{{ d.pic }}" style="width: 100px;height: 100px"></div>'
                }
                    , {rowspan: 2, align: 'center', title: '商品名称', toolbar: '#barGoods'}
                    , {rowspan: 2, align: 'center', title: '价格/货号', toolbar: '#barPriceAndSn'}
                    , {rowspan: 2, unresize: true, align: 'center', title: '标签', toolbar: '#barLabel'}
                    , {rowspan: 2, align: 'center', field: 'sort', title: '排序', sort: true}
                    , {
                    rowspan: 2,
                    align: 'center',
                    fixed: 'right',
                    toolbar: '#label',
                    width: 80,
                    title: 'SKU库存',
                    sort: true
                }
                    , {rowspan: 2, align: 'center', field: 'sale', title: '销量', sort: true}
                    , {rowspan: 2, align: 'center', title: '审核状态', toolbar: '#barVerify'}
                    , {rowspan: 2, fixed: 'right', align: 'center', title: '操作', toolbar: '#barDemo'}
                ],
            ]
            , page: true
            , id: 'testReload'
            , even: 'true'
            , event: 'true'
            , done: function (res, curr, count) {
                var data = res.data;
                console.log(data)
                console.log(curr)
                console.log(count)
                layer.closeAll('loading')
            }
        });

        //监听性别操作
        form.on('switch(sexDemo)', function (obj) {
            layer.tips(this.value + ' ' + this.name + '：' + obj.elem.checked, obj.othis);
        });

        form.on('submit(search)', function (data) {
            layer.load();
            tableIns.reload({
                url: "/pms-product/getPageProductInfo/"
                , dataType: "json"
                , data: $("#formBtn").serialize()
                , page: {
                    curr: 1
                }, where: {
                    id: data.field.id
                    , pic: data.field.pic
                    , name: data.field.name
                    , brandName: data.field.brandName
                    , price: data.field.price
                    , productSn: data.field.productSn
                    , newStatusStr: data.field.newStatusStr
                    , publishStatusStr: data.field.publishStatusStr
                    , recommandStatus: data.field.recommandStatus
                    , sort: data.field.sort
                    , sale: data.field.sale
                    , verifyStatusStr: data.field.verifyStatusStr
                }
            });
        });
        //触发事件
        var active = {
            offset: function (othis) {
                var type = othis.data('type')
                layer.open({
                    type: 2
                    , anim: 5
                    , title: '编辑货品信息'
                    , offset: type //具体配置参考：http://www.layui.com/doc/modules/layer.html#offset
                    , id: 'layerDemo' + type //防止重复弹出
                    , content: 'http://localhost:8080/pms-product/gotoProductSpecification'
                    , btn: ['取消', '确定']
                    , area: ['800px', '500px']
                    , btnAlign: 'c' //按钮居中
                    , shade: 0 //不显示遮罩
                    , yes: function () {
                        layer.closeAll();
                    }
                });
            }
        };
        //自定义点击事件
        btnFun = function (id) {
            $('#' + id + ' .layui-btn').on('click', function () {
                var othis = $(this), method = othis.data('method');
                active[method] ? active[method].call(this, othis) : '';
            });
        }
        // $("#subBtn").on("click", function () {
        //     $.ajax({
        //         type: "POST"
        //         , dataType: "json"
        //         , url: "/pms-product/getPageProductInfo"
        //         , data: $("#formBtn").serialize()
        //         , success: function (date) {
        //             console.log(date)
        //         }
        //     })
        // })
    });
</script>
</body>
</html>